<!DOCTYPE html>
<html lang="ja">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>



<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>BSTより高速なデータ構造、Y-Fast Trie [UEC Advent Calendar 2024] 12日目 - InTheDayDream</title>
<meta name="description" content="">

<meta name="author" content="">

<link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png?c=52acc9b85c145bd733f3d84f5383c92420e9a13b">
<link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.png?c=52acc9b85c145bd733f3d84f5383c92420e9a13b">
<link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png?c=52acc9b85c145bd733f3d84f5383c92420e9a13b">
<link rel="alternate" href="/index.xml?c=52acc9b85c145bd733f3d84f5383c92420e9a13b" type="application/rss+xml" title="RSS" />
<meta property="og:title" content="BSTより高速なデータ構造、Y-Fast Trie [UEC Advent Calendar 2024] 12日目 - InTheDayDream">
<meta property="og:url" content="http://localhost:1313/post/uec-advent2024/">
<meta property="og:type" content="article">
<meta property="og:site_name" content="InTheDayDream">
<meta property="og:description" content="">

<meta property="og:image" content="http://localhost:1313//images/featured_image.jpg">

<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:site" content="@UU9782wsEdANDhp">
<meta name="twitter:creator" content="@UU9782wsEdANDhp">
<meta name="twitter:title" content="BSTより高速なデータ構造、Y-Fast Trie [UEC Advent Calendar 2024] 12日目 - InTheDayDream">
<meta name="twitter:url" content="http://localhost:1313/post/uec-advent2024/">
<meta name="twitter:description" content="">

<meta property="og:image" content="http://localhost:1313//images/featured_image.jpg">


<link rel="stylesheet" href="/css/main.css?c=52acc9b85c145bd733f3d84f5383c92420e9a13b">
<link rel="stylesheet" href="/css/color.css?c=52acc9b85c145bd733f3d84f5383c92420e9a13b">


<link rel="stylesheet" href="/css/custom.css?c=52acc9b85c145bd733f3d84f5383c92420e9a13b">



</head>

<body class="theme-default">





<link rel="stylesheet" href="/katex/katex.min.css">
<script defer src="/katex/katex.min.js"></script>
<script defer src="/katex/contrib/auto-render.min.js"></script>
<script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement(document.body, {
          
          
          delimiters: [
              {left: '$$', right: '$$', display: true},
              {left: '$', right: '$', display: false},
              
              
          ],
          
          throwOnError : false
        });
    });
</script>



<div id="content-header" class="title">
  
  <a class="site-title" href="/">InTheDayDream</a>
  
  <span class="site-sub-title"></span>

  

  <div id="main-menu-nav">
    <div id="main-menu-nav-items">
      
        <div class="nav-item"><a href="/">Home</a></div>
      
        <div class="nav-item"><a href="/tags/">Tags</a></div>
      
        <div class="nav-item"><a href="/archives/">Archives</a></div>
      
        <div class="nav-item"><a href="/about/">About</a></div>
      
        <div class="nav-item"><a href="/search/">Search</a></div>
      
    </div>
  </div>
</div>
<div id="content" class="main">




<h1>BSTより高速なデータ構造、Y-Fast Trie [UEC Advent Calendar 2024] 12日目</h1>

<span class="sub">Published on 2024-12-12</span><br>
<span class="sub">Last Modified 2024-12-12</span>






<div style="padding: 0em 1em; margin-bottom: 5em; margin-top: 0.7em;">
    <p style="font-size: 1.3em;">Table Of Contents</p>
<nav id="TableOfContents">
  <ul>
    <li><a href="#まえがき">まえがき</a></li>
    <li><a href="#はじめに">はじめに</a></li>
    <li><a href="#y-fast-trieの概要">Y-Fast Trieの概要</a>
      <ul>
        <li><a href="#y-fast-trieのインターフェース">Y-Fast Trieのインターフェース</a></li>
      </ul>
    </li>
    <li><a href="#binary-trieによるsuccessor-query">Binary Trieによるsuccessor query</a>
      <ul>
        <li><a href="#binary-trie">Binary Trie</a></li>
      </ul>
    </li>
  </ul>
</nav>
</div>



<h2 id="まえがき">まえがき</h2>
<p>こんにちは、<a href="https://x.com/UU9782wsEdANDhp">InTheBloom</a>です。
今年もUECアドカレの季節がやってきましたね。Twitterでカレンダーが生えたのを観測したので、これ幸いと枠をいただきました。これで3年目になります。</p>
<p>このエントリはUEC Advent Calendar 2024の12日目を担当します。</p>
<iframe src="https://adventar.org/calendars/10127/embed" width="620" height="362" frameborder="0" loading="lazy"></iframe>
<p>また、今年もUEC2が建っています。こちらもぜひどうぞ。</p>
<iframe src="https://adventar.org/calendars/10198/embed" width="620" height="362" frameborder="0" loading="lazy"></iframe>
<p>11日目はえぐちさんの<a href="https://zenn.dev/kk79it/articles/proxmox-tutorial">Proxmoxの運用Tips【自宅鯖】</a>でした。
自宅鯖という単語、非常に魅力的に感じます。とは言いつつ、前提知識がなさすぎて大半が呪文に見えました。。勉強が必要そうです。</p>
<p>UEC2ははんかくさんが担当ですが、まだアップされていないみたいです。</p>
<p>今年も力作ぞろいです。これからのエントリも楽しみですね！</p>
<h2 id="はじめに">はじめに</h2>
<p>このエントリでは、Y-Fast Trie(ワイ-ファスト トライ)と呼ばれるデータ構造の動作原理を説明し、実際に組んだものを示します。
Y-Fast Trieの美しさ、ロマンを体感してください！</p>
<p>誤りの指摘は随時募集しています。指摘いただいたものは随時修正していきますので、お気軽にどうぞ。</p>
<h2 id="y-fast-trieの概要">Y-Fast Trieの概要</h2>
<p>Y-Fast Trieは非負整数値に対して各種操作を提供する<strong>データ構造</strong>です。</p>
<p>データ構造とは何かについて厳密に定義を与えるのは難しいです。
ここでは、大まかに、<strong>できる操作の集合</strong>と、<strong>操作を実現する具体的なアルゴリズム</strong>をひとまとめにしたものをデータ構造と呼ぶことにしましょう。</p>
<p>前者を<strong>インターフェース</strong>、後者を<strong>内部実装</strong>と呼ぶことにします。</p>
<p>性能を議論する上で、各種操作をどれくらい効率よく、どれくらい省メモリで行えるかが知りたいです。
そこで、本文書内ではインターフェースについて考えるとき、同時に各種操作の時間計算量と、全体を通しての空間計算量に言及します。</p>
<p>計算量というのは、かかる時間や必要な領域を定量的に評価するための概念です。
詳細は<a href="https://noshi91.hatenablog.com/entry/2019/10/08/235335">計算量について(外部リンク)</a>を参照してください。</p>
<p>例えば、C++の<code>std::vector</code>は</p>
<ul>
<li>$i$番目の要素への読み書き: $O(1)$時間</li>
<li>要素を末尾へ挿入: ならし$O(1)$時間</li>
</ul>
<p>というインターフェースを提供するデータ構造です。空間計算量は、確保した列の長さ$N$に対して、$O(N)$です。
空間計算量が$O(N)$であるとは、格納した値や補助のデータを含めて$O(N)$byteしか必要としないことを表します。</p>
<h3 id="y-fast-trieのインターフェース">Y-Fast Trieのインターフェース</h3>
<p>Y-Fast Trieは、扱う整数の範囲を$\lbrack 0, 2 ^ w - 1 \rbrack$としたとき、以下のインターフェースを提供します。</p>
<table>
  <thead>
      <tr>
          <th>操作</th>
          <th>内容</th>
          <th>時間計算量</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>$\mathrm{insert}(x)$</td>
          <td>集合に$x$を追加する</td>
          <td>$\text{expected } O(\log(w))$</td>
      </tr>
      <tr>
          <td>$\mathrm{remove}(x)$</td>
          <td>集合から$x$を削除する</td>
          <td>$\text{expected } O(\log(w))$</td>
      </tr>
      <tr>
          <td>$\mathrm{successor}(x)$</td>
          <td>集合に含まれる$x$以上最小の値を返す</td>
          <td>$\text{expected } O(\log(w))$</td>
      </tr>
      <tr>
          <td>$\mathrm{predecessor}(x)$</td>
          <td>集合に含まれる$x$以下最大の値を返す</td>
          <td>$\text{expected } O(\log(w))$</td>
      </tr>
  </tbody>
</table>
<p>$\text{expected}$という表記はその操作にかかる時間が確率変数で表現されることを表します。値はその期待値です。</p>
<p>このインターフェースの内部実装を<a href="https://ja.wikipedia.org/wiki/%E8%B5%A4%E9%BB%92%E6%9C%A8">赤黒木</a>や<a href="https://ja.wikipedia.org/wiki/AVL%E6%9C%A8">AVL木</a>といった二分探索木にした場合、各操作は全体の操作回数を$N$として、$O(\log(N))$時間になります。
一方、Y-Fast Trieは$N$に依存することなく、$O(\log(w))$時間です。</p>
<p>$w$は整数を表現するのに必要なビット数であり、ほとんどのケースで$w \leq 64$になります。自然な仮定の元ではY-Fast Trieは二分探索木よりも理論的に高速です。</p>
<p>驚くべきことに、Y-Fast Trie空間計算量は$O(N)$です。
扱う値を非負整数に絞ることにより、二分探索木と同等レベルに省メモリかつ二分探索木よりも期待値的に高速な操作を提供します。</p>
<p>つまり、ロマンたっぷりというわけです。</p>
<p>前置きはここまでです。次の章からはY-Fast Trieの動作原理を見ていきましょう。</p>
<h2 id="binary-trieによるsuccessor-query">Binary Trieによるsuccessor query</h2>
<p>Y-Fast Trieの仕組みを理解するためには、trie木を知る必要があります。
trieは<strong>グラフ</strong>の一種です。グラフとは、頂点集合$V$と頂点間を結ぶ辺集合$E$の組のことで、ものとものの<strong>つながりかた</strong>だけを抜き出した数学モデルです。</p>
<p><img src="/images/uec-advent2024/graph_sample.png" alt="graph\_sample.png"></p>
<p>これがグラフです。この場合、頂点数が6で、辺数が8です。<a href="https://csacademy.com/app/graph_editor/">Graph Editor</a>でビジュアライザを試すことができます。</p>
<p>プログラム上でグラフを表現するさいは、通常隣接リストを用いた表現を使います。
これは、各頂点に対応する構造体をつくり、辺を別の構造体へのポインタで表すものです。
以下に疑似コードを示します。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-d" data-lang="d"><span style="display:flex;"><span><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">vertex</span> <span style="color:#f92672">{</span> <span style="color:#75715e">// vertex: 「頂点」の意
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    Data data<span style="color:#f92672">;</span> <span style="color:#75715e">// 頂点番号や、それ以外の値をもたせることもある
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    vertex <span style="color:#f92672">*[]</span> adj<span style="color:#f92672">;</span> <span style="color:#75715e">// 自分から辺がある頂点へのポインタ
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// その他、辺に重みをつけることもある
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#f92672">}</span>
</span></span></code></pre></div><p>うまく実装すると、$O(\vert V \vert + \vert E \vert)$の空間でグラフを表現することができます。</p>
<p>trieは、文字列の集合を表現するグラフです。
常に次のルールに従っています。</p>
<ul>
<li>根と呼ばれる「スタート地点」をもつ。</li>
<li>各辺には文字が割り当てられる。</li>
<li>根は空文字列を表現する。他の頂点は、根からそこまでたどったときに通った辺の文字を連結した文字列を表現する。</li>
</ul>
<p><img src="/images/uec-advent2024/trie_wiki.png" alt="trie木"></p>
<p>wikipediaの<a href="https://ja.wikipedia.org/wiki/%E3%83%88%E3%83%A9%E3%82%A4_(%E3%83%87%E3%83%BC%E3%82%BF%E6%A7%8B%E9%80%A0)">トライ</a>からパブリックドメインの画像をお借りしました。
これがtrie木です。&ldquo;A&rdquo;, &ldquo;to&rdquo;, &ldquo;tea&rdquo;, &ldquo;ted&rdquo;, &ldquo;ten&rdquo;, &ldquo;i&rdquo;, &ldquo;in&rdquo;, &ldquo;inn&quot;から構築されています。</p>
<p>trieに文字列を追加/削除することもできます。</p>
<p>追加するときは、根から出来るだけ既存の頂点を経由して文字を伸ばしていけばよいです。
削除するときは、その文字列を表現する頂点からはじめて、他の文字列に影響しない部分の頂点を削除しながら根までのぼっていけばよいです。</p>
<h3 id="binary-trie">Binary Trie</h3>
<p>進数表記された数字を文字列として扱うことができます。
つまり、1234を&quot;1234&rdquo;、432795を&quot;432795&quot;としてみなすということです。
これにより、trieで数字を扱うことができるようになります。</p>
<p>trieの辺に乗せられる文字を&quot;0&quot;と&quot;1&quot;に限定することにします。
すると、各ノードは0と1の連結を表現します。
こうすることで、任意の数を</p>






<hr class="block-separater">




<div class="content-footer-item">
	Tags for this post:
	
	<a class="post-tag" href="/tags/%E3%82%A2%E3%83%AB%E3%82%B4%E3%83%AA%E3%82%BA%E3%83%A0/">アルゴリズム</a>
	
	<a class="post-tag" href="/tags/%E3%83%87%E3%83%BC%E3%82%BF%E6%A7%8B%E9%80%A0/">データ構造</a>
	
	<a class="post-tag" href="/tags/uec-advent-calendar/">UEC Advent Calendar</a>
	
</div>







<div class="content-footer-item neighbor">
	
	<div class="prev-post">Prev: <a href="/post/subsequences-by-delimiter/">区切り文字による連続部分列の切り出し</a></div>
	
	
</div>











    
    
    
    <div class="related-tag-category-list">
        <h4 style="font-size: 1.3em;">Other posts tagged by "アルゴリズム"</h4>
        <ul class="post-list">
          
          <li class="post-item">
  <div class="post-date sub">2024-12-12</div>
  <div class="post-title"><a href="/post/uec-advent2024/">BSTより高速なデータ構造、Y-Fast Trie [UEC Advent Calendar 2024] 12日目</a></div>
  
</li>
          
          <li class="post-item">
  <div class="post-date sub">2024-11-19</div>
  <div class="post-title"><a href="/post/unifying-segments-with-unionfind/">UnionFindによる区間の統合</a></div>
  
</li>
          
          <li class="post-item">
  <div class="post-date sub">2024-10-19</div>
  <div class="post-title"><a href="/post/functional-graph-logn-simulation/">Functional GraphでK回進むクエリ in &lt;O(NlogN), O(logN)&gt;</a></div>
  
</li>
          
        </ul>
        <div class="more-area">
          
          <a class="more" href='/tags/%e3%82%a2%e3%83%ab%e3%82%b4%e3%83%aa%e3%82%ba%e3%83%a0/'>more ...</a>
          
      </div>
        </div>
    

    
    
    

    
    
    




<script src="/js/single.js"></script>





	</div><div id="content-footer" class="sub">
  
  <div class="credit">
    Power by <a href="https://gohugo.io">Hugo</a> /
    Theme <a href="https://github.com/michimani/simplog/">simplog</a> by <a href="https://github.com/michimani/">michimani</a>
  </div>
</div></body>

</html>